---
// src/pages/ouvidoria.astro
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
---

<Layout title="Ouvidoria e Fale Conosco | emguapi.com">
    <Navbar />

    <main class="max-w-5xl mx-auto p-6 my-12">
        
        <header class="mb-12 border-b border-gray-200 pb-8">
            <div class="flex items-center gap-3 mb-2">
                <span class="w-2 h-8 bg-red-base inline-block rounded-sm"></span>
                <h1 class="text-4xl font-black text-navy-dark uppercase tracking-tighter">
                    Ouvidoria
                </h1>
            </div>
            <p class="text-gray-600 font-medium max-w-2xl mt-4">
                O canal direto entre você e a redação do <strong>emguapi.com</strong>. Utilize este espaço para enviar sugestões de pautas, solicitar correções em reportagens, fazer críticas ou elogios ao nosso trabalho.
            </p>
        </header>

        <div class="grid lg:grid-cols-3 gap-10">
            
            <div class="lg:col-span-1 space-y-6">
                <h2 class="text-sm font-black uppercase tracking-widest text-navy-dark mb-4">Contatos Diretos</h2>
                
                <a href="https://wa.me/5521969400053" target="_blank" class="block bg-gray-50 border border-gray-200 p-5 rounded-lg hover:border-[#25D366] transition-colors group shadow-sm">
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-10 h-10 bg-[#25D366]/10 rounded-md flex items-center justify-center text-[#25D366] group-hover:bg-[#25D366] group-hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                        </div>
                        <div>
                            <span class="block font-black text-navy-dark group-hover:text-[#25D366] transition-colors">WhatsApp</span>
                            <span class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">Resposta Rápida</span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-600 mt-3 leading-relaxed">Envie mensagens de texto, áudio ou arquivos diretamente para o plantão da nossa redação.</p>
                </a>

                <a href="mailto:redacao@emguapi.com" class="block bg-gray-50 border border-gray-200 p-5 rounded-lg hover:border-red-base transition-colors group shadow-sm">
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-10 h-10 bg-red-base/10 rounded-md flex items-center justify-center text-red-base group-hover:bg-red-base group-hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        </div>
                        <div>
                            <span class="block font-black text-navy-dark group-hover:text-red-base transition-colors">Redação</span>
                            <span class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">redacao@emguapi.com</span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-600 mt-3 leading-relaxed">Para envio de releases, notas oficiais, pedidos de cobertura e correções de matérias.</p>
                </a>

                <a href="mailto:anuncie@emguapi.com" class="block bg-gray-50 border border-gray-200 p-5 rounded-lg hover:border-navy-base transition-colors group shadow-sm">
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-10 h-10 bg-navy-base/10 rounded-md flex items-center justify-center text-navy-base group-hover:bg-navy-base group-hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                        </div>
                        <div>
                            <span class="block font-black text-navy-dark group-hover:text-navy-base transition-colors">Comercial</span>
                            <span class="text-[10px] uppercase tracking-widest text-gray-500 font-bold">anuncie@emguapi.com</span>
                        </div>
                    </div>
                    <p class="text-xs text-gray-600 mt-3 leading-relaxed">Para anunciar no portal, parcerias de mídia e inclusão no Guia Comercial.</p>
                </a>
            </div>

            <div class="lg:col-span-2">
                <div class="bg-white shadow-lg rounded-lg overflow-hidden border-t-8 border-navy-base p-8 border border-gray-200 h-full relative">
                    
                    {/* CONTAINER DO FORMULÁRIO */}
                    <div id="form-container">
                        <h2 class="text-lg font-black uppercase tracking-tight text-navy-dark mb-6">Envie sua mensagem</h2>

                        <form id="ouvidoria-form" class="space-y-6">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-[10px] font-black uppercase text-gray-500 mb-2 tracking-widest">Nome Completo</label>
                                    <input type="text" name="nome" required placeholder="Seu nome" class="w-full bg-gray-50 text-navy-dark p-4 rounded-sm font-medium border border-gray-200 focus:border-navy-base focus:bg-white outline-none transition-all" />
                                </div>
                                <div>
                                    <label class="block text-[10px] font-black uppercase text-gray-500 mb-2 tracking-widest">E-mail de Contato</label>
                                    <input type="email" name="email" required placeholder="Para podermos retornar" class="w-full bg-gray-50 text-navy-dark p-4 rounded-sm font-medium border border-gray-200 focus:border-navy-base focus:bg-white outline-none transition-all" />
                                </div>
                            </div>

                            <div>
                                <label class="block text-[10px] font-black uppercase text-gray-500 mb-2 tracking-widest">Assunto</label>
                                <select name="assunto" required class="w-full bg-gray-50 text-navy-dark p-4 rounded-sm font-bold border border-gray-200 focus:border-navy-base focus:bg-white outline-none transition-all cursor-pointer">
                                    <option value="">Selecione o motivo do contato</option>
                                    <option value="Sugestão de Pauta">Sugestão de Pauta</option>
                                    <option value="Correção de Informação">Correção de Informação / Erroata</option>
                                    <option value="Reclamação">Reclamação</option>
                                    <option value="Elogio">Elogio</option>
                                    <option value="Dúvida Geral">Dúvida Geral</option>
                                    <option value="Outros">Outros</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-[10px] font-black uppercase text-gray-500 mb-2 tracking-widest">Sua Mensagem</label>
                                <textarea name="mensagem" rows="6" required placeholder="Escreva sua mensagem com o máximo de detalhes possível..." class="w-full bg-gray-50 text-navy-dark p-4 rounded-sm font-medium border border-gray-200 focus:border-navy-base focus:bg-white outline-none resize-none transition-all"></textarea>
                            </div>
                            
                            <button type="submit" id="btn-enviar" class="w-full bg-navy-base hover:bg-navy-dark text-white p-5 rounded-md font-black uppercase tracking-widest shadow-md transition-all active:scale-95 flex items-center justify-center gap-3">
                                Enviar Mensagem
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                                </svg>
                            </button>
                        </form>

                        <div class="mt-6 border-t border-gray-100 pt-6">
                            <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider text-center">
                                Garantimos o sigilo da fonte caso solicitado na mensagem.
                            </p>
                        </div>
                    </div>

                    {/* MENSAGEM DE SUCESSO (Oculta por padrão) */}
                    <div id="success-message" class="hidden flex flex-col items-center justify-center text-center py-12 h-full">
                        <div class="w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" class="w-10 h-10">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-black uppercase tracking-tighter text-navy-dark mb-2">Mensagem Enviada!</h3>
                        <p class="text-gray-600">Agradecemos o seu contato. Nossa redação analisará sua mensagem e retornará o mais breve possível.</p>
                        <button onclick="window.location.reload()" class="mt-8 text-xs font-black uppercase tracking-widest text-navy-base border border-navy-base px-6 py-3 rounded-md hover:bg-navy-base hover:text-white transition-colors">
                            Enviar nova mensagem
                        </button>
                    </div>

                </div>
            </div>
        </div>

    </main>
</Layout>

<script>
    const form = document.getElementById('ouvidoria-form') as HTMLFormElement;
    const formContainer = document.getElementById('form-container');
    const successMessage = document.getElementById('success-message');
    const btnEnviar = document.getElementById('btn-enviar') as HTMLButtonElement;

    // COLOQUE O SEU CÓDIGO DO FORMSPREE AQUI
    // Exemplo: https://formspree.io/f/xabcdefg
    const URL_DO_SEU_FORMSPREE = "https://formspree.io/f/movagaye"; 

    if (form) {
        form.addEventListener('submit', async (e: Event) => {
            e.preventDefault();
            
            // Verifica se você colocou a URL real
            if (URL_DO_SEU_FORMSPREE === "https://formspree.io/f/movagaye") {
                alert("Por favor, configure o link no código primeiro!");
                return;
            }

            // Muda o botão para "Enviando..."
            const textoOriginal = btnEnviar.innerHTML;
            btnEnviar.innerHTML = "Enviando...";
            btnEnviar.disabled = true;
            btnEnviar.classList.add('opacity-50', 'cursor-not-allowed');

            const formData = new FormData(form);

            try {
                const response = await fetch(URL_DO_SEU_FORMSPREE, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    // Esconde o formulário e mostra a mensagem de sucesso
                    formContainer?.classList.add('hidden');
                    successMessage?.classList.remove('hidden');
                    form.reset();
                } else {
                    alert("Ocorreu um erro no servidor. Tente novamente mais tarde.");
                }
            } catch (error) {
                alert("Erro de conexão. Verifique sua internet e tente novamente.");
            } finally {
                // Restaura o botão caso dê erro
                btnEnviar.innerHTML = textoOriginal;
                btnEnviar.disabled = false;
                btnEnviar.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });
    }
</script>